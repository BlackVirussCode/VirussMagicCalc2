<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>iPhone Style Calculator</title>

<!-- ======= iOS full screen ======= -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
*,
*::after,
*::before {
  padding: 0;
  margin: 0;
  font-family: inherit;
  box-sizing: border-box;
}

html, body {
  height: 100dvh; /* реальная высота экрана без полосы свайпа */
  width: 100%;
  margin: 0;
  padding: 0;
  background-color: #333;
  display: flex;
  justify-content: center;
  align-items: center;
}

button {
  cursor: pointer;
  border: 0;
}

input[type="text"] {
  background-color: transparent;
  text-align: end;
  width: 100%;
  color: #d2d2d2;
  border: 0;
  font-size: 4rem;
}

#main {
  width: 100%;
  height: 100%;
  max-width: 500px;
  background-color: #000;
  border-radius: 0; /* убираем скругление, чтобы заняло весь экран */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 1rem;
}

.calc_header {
  margin-top: 20px;
  padding: 12px;
}

.calc_footer > * + * {
  margin-top: 1rem;
}

.calc_footer > *:last-child {
  gap: 1rem;
}

.btn_group {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.3rem;
}

.btn {
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  color: #fff;
  font-size: 20px;
  transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
}

.btn.btn-grow {
  flex-grow: 1;
  border-radius: 40px;
}

.btn:hover {
  transform: translate(-2px, -3px);
}

.btn.active {
  background-color: #fff;
  color: #f69906;
}

.btn-grey {
  background-color: #9f9f9f;
  color: #000;
}

.btn-grey:hover {
  background-color: #ededed;
}

.btn-dark-grey {
  background-color: #313131;
}

.btn-dark-grey:hover {
  background-color: #999;
}

.btn-orange {
  background-color: #f69906;
}

.btn-orange:hover {
  background-color: orange;
}
</style>
</head>
<body>

<main id="main">
  <form id="calc_form">
    <header class="calc_header">
      <input type="text" id="output" class="calc_output" value="0" readonly />
    </header>

    <footer class="calc_footer">
      <!-- Ваши кнопки как в исходном коде -->
      <div class="btn_group">
        <button type="button" class="btn btn-grey" id="reset">AC</button>
        <button type="button" data-type="operator" value="invert" class="btn btn-grey">+/-</button>
        <button type="button" data-type="operator" value="%" class="btn btn-grey">%</button>
        <button type="button" data-type="operator" value="/" class="btn btn-orange">÷</button>
      </div>
      <!-- остальные ряды кнопок -->
      <div class="btn_group">
        <button type="button" data-type="operand" value="7" class="btn btn-dark-grey">7</button>
        <button type="button" data-type="operand" value="8" class="btn btn-dark-grey">8</button>
        <button type="button" data-type="operand" value="9" class="btn btn-dark-grey">9</button>
        <button type="button" data-type="operator" value="*" class="btn btn-orange">x</button>
      </div>
      <div class="btn_group">
        <button type="button" data-type="operand" value="4" class="btn btn-dark-grey">4</button>
        <button type="button" data-type="operand" value="5" class="btn btn-dark-grey">5</button>
        <button type="button" data-type="operand" value="6" class="btn btn-dark-grey">6</button>
        <button type="button" data-type="operator" value="-" class="btn btn-orange">-</button>
      </div>
      <div class="btn_group">
        <button type="button" data-type="operand" value="1" class="btn btn-dark-grey">1</button>
        <button type="button" data-type="operand" value="2" class="btn btn-dark-grey">2</button>
        <button type="button" data-type="operand" value="3" class="btn btn-dark-grey">3</button>
        <button type="button" data-type="operator" value="+" class="btn btn-orange">+</button>
      </div>
      <div class="btn_group">
        <button type="button" data-type="operand" value="0" class="btn btn-dark-grey btn-grow">0</button>
        <button type="button" data-type="operand" value="." class="btn btn-dark-grey">.</button>
        <button type="button" data-type="operator" value="=" class="btn btn-orange">=</button>
      </div>
    </footer>
  </form>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const output = document.getElementById("output");
  const operand_btns = document.querySelectorAll("button[data-type=operand]");
  const operator_btns = document.querySelectorAll("button[data-type=operator]");
  const reset_btn = document.getElementById("reset");

  let is_operator = false;
  let equation = [];
  let equalsCount = 0;

  const remove_active = () => operator_btns.forEach(btn => btn.classList.remove("active"));

  operand_btns.forEach(btn => {
    btn.addEventListener("click", e => {
      remove_active();
      if (is_operator || output.value === "0") {
        output.value = e.target.value;
        is_operator = false;
      } else if (e.target.value === "." && output.value.includes(".")) {
        return;
      } else {
        output.value += e.target.value;
      }
    });
  });

  operator_btns.forEach(btn => {
    btn.addEventListener("click", e => {
      remove_active();
      e.currentTarget.classList.add("active");
      const value = e.target.value;

      switch(value) {
        case "%":
          output.value = parseFloat(output.value)/100;
          break;
        case "invert":
          output.value = parseFloat(output.value)*-1;
          break;
        case "=":
          equation.push(output.value);
          equalsCount++;
          if(equalsCount === 5){
            output.value = 3507201;
            equalsCount = 0;
          } else {
            output.value = eval(equation.join(""));
          }
          equation = [];
          is_operator = false;
          break;
        default:
          equation.push(output.value);
          equation.push(value);
          is_operator = true;
      }
    });
  });

  reset_btn.addEventListener("click", () => {
    output.value = "0";
    equation = [];
    is_operator = false;
    equalsCount = 0;
    remove_active();
  });
});
</script>
</body>
</html>
